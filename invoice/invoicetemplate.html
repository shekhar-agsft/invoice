<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <link rel="stylesheet" href="css/toaster.css">
    <script src="js/toaster.js"></script>
    <style>
        .text-center {
            text-align: center;
            color: black;
            background-color: grey;

        }

        .header {
            height: 50px;
            line-height: 46px;
            font-size: 31px;
        }

        .image {
            height: 110px
        }

        .tble-header {
            color: black;
            background-color: grey;

        }

        .tble-body {}

        .bank {
            font-size: 20px;
            font-weight: bold;
        }

        .bank-details {
            color: black;
            background-color: grey;

        }

        .btn-custom {
            float: right;
            margin-top: 7px;
            border-radius: 0;
            box-shadow: 0 10px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19) !important;
        }
        td{
            padding: 6px;
            border: 1px solid #ddd;

        }
    </style>
</head>

<body>
    <div class="container" style="    border: 1px solid;">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="header">
                    <label>INVOICE </label>
                    <button class="btn btn-info btn-custom" style="margin-bottom:5px; float:left" type="button" onclick="backto()">Back</button>
                    <button class="btn btn-primary btn-custom" type="button" style="float:right;margin-left:2px;" onclick="logOut()">Sign Out</button>

                    <button class="btn btn-warning btn-custom" type="button" onclick="exportData()">Export</button>

                </div>
                <div>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <img src="/images/agile.jpeg" class="image">
            </div>
            <div class="col-md-3" >
                <!-- <label style="padding-top: 75px;">Bill To</label> -->
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <p style="margin-bottom: 0;">
                    <label>Agile Soft Systems, Inc</label>
                </p>
                <p style="margin-bottom: 0;">
                    <label>38930 Blacow Rd Ste B3</label>
                </p>
                <p>
                    <label>Fremont, CA 94536</label>
                </p>
            </div>
            <div class="col-md-3" >
                <p style="font-weight: bold">Bill To,</p>
                <p class="tble-body" style="margin-bottom:0">
                    <label id="name"></label>
                </p>
                <p class="tble-body">
                    <label id="address1"></label>
                </p>

            </div>
        </div>
        <div class="row">
            <div class="col-md-6"></div>
            <div class="col-md-6"></div>
        </div>
        <div class="row">
         
            <div class="col-md-9">
                <p style="margin-bottom: 0;"> PO/Agreement #:
                    <span class="tble-body" id="poagreement">Dt 7/7/17</span>
                </p>
                <p>Period:
                    <span class="tble-body" id="period">Jan 2018</span>
                </p>
            </div>
            <div class="col-md-3" style="text-align:justify">
                <p>Invoice Date:
                    <span class="tble-body" id="invoicedate">02/01/2018</span>
                </p>
                <p>Invoice #:
                    <span class="tble-body" id="invoicenumber">AGS1801</span>
                </p>
                <p>Invoice Amount:
                    <span class="tble-body" id="amount">$550</span>
                </p>
                <p>Invoice Due:
                    <span>On receipt</span>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="location">
                        <thead class="tble-header">
                            <tr>
                                <th>Project</th>
                                <th>Resources</th>
                                <th>Period</th>
                                <th>Type</th>
                                <th>Amt Bill</th>
                            </tr>
                        </thead>



                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <p class="bank"> Pay through <span id="bankname"></span> Bank</p>
                                    <p style="margin-bottom:0;"> <span id="accountcompany"></span></p>
                                    <p style="margin-bottom:0;margin-top:0"><span id="accountaddress1"></span></p>
                                    <p style="margin-bottom:0;margin-top:0"><span id="accountaddress2"></span></p>
                                    <p style="margin-bottom:0;margin-top:0"><span id="accountaddress3"></span></p>
                                   <!--  <p style="margin-bottom:0;margin-top:0">Fremont, CA 94536</p> -->
                                    <p style="margin-bottom:0;margin-top:0" class="bank-details"><span id="bankName"></span> Bank Acct #
                                        <span id="accountNo"></span>
                                    </p>
                                    <p style="margin-bottom:0;margin-top:0" class="bank-details">ABA #
                                        <span id="abcno"></span>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    var service = 'http://localhost:8080';



    $(document).ready(function () {
        var custId = localStorage.getItem("custId");
        var invoiceId = localStorage.getItem("invoiceId");
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        $.ajax(
            {
                type: "GET",
                url: 'http://127.0.0.1:8080/getCustomerDetails/' + custId + "/" + invoiceId,
                headers: { "Authorization": localStorage.getItem('token') },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    console.log(data.response_body)

                    // for (var i = 0; i < data.response_body.customers.length; i++) {
                    var cust = data.response_body;
                    var cdata = data.response_body;

                    $("#name").text(cust.name);
                    $("#address1").text(cust.address);

                    var fullDate = new Date(cust.invoiceDate)
                    var twoDigitMonth = ((fullDate.getMonth().length + 1) === 1) ? (fullDate.getMonth() + 1) : '0' + (fullDate.getMonth() + 1);
                    invoiceDate = new Date(cust.invoiceDate);
                    var currentDate = fullDate.getDate() + "/" + twoDigitMonth + "/" + fullDate.getFullYear();
                    $("#invoicedate").text(currentDate);
                    $("#invoicenumber").text(cust.invoiceNumber);
                    $("#poagreement").text(cust.poagreement);
                    $("#amount").text("$" + cust.amount);
                    var fullDate = new Date(new Date(cust.period))
                    var twoDigitMonth = ((fullDate.getMonth().length + 1) === 1) ? (fullDate.getMonth() + 1) : '0' + (fullDate.getMonth() + 1);

                    var currentDate = fullDate.getDate() + "/" + twoDigitMonth + "/" + fullDate.getFullYear();
                    const d = new Date(data.response_body.period);

                    $("#period").val(monthNames[d.getMonth()] + "" + new Date(d).getFullYear());
                    //$("#period").text(currentDate);
                    $("#invoicedue").text(cust.invoiceDue);
                    var totalInvoice = 0.0;

                    for (var i = 0; i < cust.invoiceProjectDetails.length; i++) {
                        $('#location').append('<tr>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].projectName + '</td>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].resources + '</td>');
                        const d1 = new Date(cust.invoiceProjectDetails[i].period);
                        $('#location').append('<td>' + monthNames[d1.getMonth()] + "" + new Date(d1).getFullYear() + '</td>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].type + '</td>');
                        $('#location').append('<td>$' + cust.invoiceProjectDetails[i].amountBilled + '</td>');
                        $('#location').append('</tr>');
                        totalInvoice = totalInvoice + cust.invoiceProjectDetails[i].amountBilled;

                    }

                    $('#location').append('<tr>');
                    $('#location').append('<td class="tble-header">Total Invoice</td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td>' + "$" + totalInvoice + '</td>');
                    $('#location').append('</tr>');
                    var nameOfCompany = cust.accountDetails.companyName.split(",");
                    
                    $('#accountcompany').text(cust.accountDetails.companyName);
                   // $('#accountaddress1').text(nameOfCompany[1]);
                    $('#accountaddress2').text(cust.accountDetails.address);
                   // $('#accountaddress3').text(nameOfCompany[3]);
                    $('#bankName').text(cust.accountDetails.bankName);
                    $('#accountNo').text(cust.accountDetails.accountNumber);
                    $('#abcno').text(cust.accountDetails.infoNumber);
                    $('#bankname').text(cust.accountDetails.bankName);
                    // }
                },

                error: function (msg) {

                    alert(msg.responseText);
                }
            });
    })

    function addInvoice(custId) {
        localStorage.setItem("custId", custId);
        window.location.href = "invoice.html";
    }

    function exportData() {

        var custId = localStorage.getItem("custId");
        var invoiceId = localStorage.getItem("invoiceId");
        $.ajax(
            {
                type: "GET",
                url: 'http://127.0.0.1:8080/export/' + custId + "/" + invoiceId,
                headers: { "Authorization": localStorage.getItem('token') },
                xhrFields: {
                    responseType: 'blob'
                },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    toastr.success("Download started");
                    var a = document.createElement('a');
                    var url = window.URL.createObjectURL(data);
                    a.href = url;
                    a.download = "invoice_" + invoiceId + '.pdf';
                    a.click();
                    window.URL.revokeObjectURL(url);

                    window.location.href = "viewcustomers.html";
                }
            });


    }

    function logOut() {

        localStorage.clear();
        window.location = "http://127.0.0.1:5500/index.html"
    }

    function backto() {
        window.location = "http://127.0.0.1:5500/viewinvoice.html"
    }
</script>

</html>