<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .text-center {
            text-align: center;
            color: #fff;
            background-color: #00cdcd
        }

        .header {
            height: 50px;
            line-height: 46px;
            font-size: 31px;
        }

        .image {
            height: 110px
        }

        .tble-header {
            color: #fff;
            background-color: #00cdcd
        }

        .tble-body {
            background-color: yellow;
        }

        .bank {
            font-size: 20px;
            font-weight: bold;
        }

        .bank-details {
            color: #fff;
            background-color: #00cdcd
        }

        .btn-custom {
            float: right;
            margin-top: 7px;
            border-radius: 0;
            box-shadow: 0 10px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19) !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="header">
                    <label>INVOICE </label>
                    <button class="btn btn-warning btn-custom" type="button" onclick="exportData()">Export</button>
                </div>
                <div>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <img src="/images/agile.jpeg" class="image">
            </div>
            <div class="col-md-6">
                <label style="    padding-top: 75px;">Bill To</label>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <p>
                    <label>Agile Soft Systems, Inc</label>
                </p>
                <p>
                    <label>38930 Blacow Rd Ste B3</label>
                </p>
                <p>
                    <label>Fremont, CA 94536</label>
                </p>
            </div>
            <div class="col-md-6">
                <p class="tble-body">
                    <label id="name"></label>
                </p>
                <p class="tble-body">
                    <label id="address1"></label>
                </p>

            </div>
        </div>
        <div class="row">
            <div class="col-md-6"></div>
            <div class="col-md-6"></div>
        </div>
        <div class="row">
            <div class="col-md-2">

            </div>
            <div class="col-md-4">
                <p> PO/Agreement #:
                    <span class="tble-body" id="poagreement">Dt 7/7/17</span>
                </p>
                <p>Period:
                    <span class="tble-body" id="period">Jan 2018</span>
                </p>
            </div>
            <div class="col-md-6">
                <p>Invoice Date:
                    <span class="tble-body" id="invoicedate">02/01/2018</span>
                </p>
                <p>Invoice #:
                    <span class="tble-body" id="invoicenumber">WE1801</span>
                </p>
                <p>Invoice Amount:
                    <span class="tble-body" id="amount">$550</span>
                </p>
                <p>Invoice Due:
                    <span>On receipt</span>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-bordered" id="location">
                        <thead class="tble-header">
                            <tr>
                                <th>Project</th>
                                <th>Resources</th>
                                <th>Period</th>
                                <th>Type</th>
                                <th>Amt Bill</th>
                            </tr>
                        </thead>



                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <p class="bank"> Pay through Wells Fargo Bank:</p>
                                    <p>Agile Soft Systems, Inc</p>
                                    <p>38930 Blacow Rd Ste B3</p>
                                    <p>Fremont, CA 94536</p>
                                    <p class="bank-details">Wells Fargo Bank Acct #
                                        <span id="accountNo">123456789</span>
                                    </p>
                                    <p class="bank-details">ABA #
                                        <span id="abcno">12345678</span>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    var service = 'http://localhost:8080';



    $(document).ready(function () {
        var custId = localStorage.getItem("custId");
        var invoiceId = localStorage.getItem("invoiceId");
        $.ajax(
            {
                type: "GET",
                url: 'http://127.0.0.1:8080/getCustomerDetails/' + custId + "/" + invoiceId,
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    console.log(data.response_body)

                    // for (var i = 0; i < data.response_body.customers.length; i++) {
                    var cust = data.response_body;
                    var cdata = data.response_body;

                    $("#name").text(cust.name);
                    $("#address1").text(cust.address);

                    var fullDate = new Date(cust.invoiceDate)
                    var twoDigitMonth = ((fullDate.getMonth().length + 1) === 1) ? (fullDate.getMonth() + 1) : '0' + (fullDate.getMonth() + 1);
                    invoiceDate = new Date(cust.invoiceDate);
                    var currentDate = fullDate.getDate() + "/" + twoDigitMonth + "/" + fullDate.getFullYear();
                    $("#invoicedate").text(currentDate);
                    $("#invoicenumber").text("WE" + cust.invoiceNumber);
                    $("#poagreement").text(cust.poagreement);
                    $("#amount").text("$" + cust.amount);
                    $("#period").text(new Date());
                    $("#invoicedue").text(cust.invoiceDue);
                    var totalInvoice = 0.0;

                    for (var i = 0; i < cust.invoiceProjectDetails.length; i++) {
                        $('#location').append('<tr>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].projectName + '</td>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].resources + '</td>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].period + '</td>');
                        $('#location').append('<td>' + cust.invoiceProjectDetails[i].type + '</td>');
                        $('#location').append('<td>$' + cust.invoiceProjectDetails[i].amountBilled + '</td>');
                        $('#location').append('</tr>');
                        totalInvoice = totalInvoice + cust.invoiceProjectDetails[i].amountBilled;

                    }

                    $('#location').append('<tr>');
                    $('#location').append('<td class="tble-header">Total Invoice</td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td></td>');
                    $('#location').append('<td>' + "$" + totalInvoice + '</td>');
                    $('#location').append('</tr>');
                    $('#accountNo').text(cust.accountDetails.accountNumber);
                    $('#abcno').text(cust.accountDetails.infoNumber);

                    // }
                },

                error: function (msg) {

                    alert(msg.responseText);
                }
            });
    })

    function addInvoice(custId) {
        localStorage.setItem("custId", custId);
        window.location.href = "invoice.html";
    }

    function exportData() {

        var custId = localStorage.getItem("custId");
        var invoiceId = localStorage.getItem("invoiceId");
        $.ajax(
            {
                type: "GET",
                url: 'http://127.0.0.1:8080/export/' + custId + "/" + invoiceId,
                xhrFields: {
                    responseType: 'blob'
                },
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    console.log(data.response_body)
                    var a = document.createElement('a');
                    var url = window.URL.createObjectURL(data);
                    a.href = url;
                    a.download = name + '.pdf';
                    a.click();
                    window.URL.revokeObjectURL(url);

                }
            });


    }

</script>

</html>